<mat-sidenav-container class="chat-container">
    <mat-sidenav class="chat-list-matches-left" mode="side" opened>
        <mat-card>
            <mat-tab-group>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <mat-icon matListIcon>forum</mat-icon>
                    </ng-template>
                    <mat-list>
                        <div class="chat-list-matches-item" *ngFor="let user of users" (click)="selectUser(user)">
                            <div class=" chat-list-match-icon">
                                <mat-icon mat-list-icon>person</mat-icon>
                            </div>
                            <div class="chat-list-match-infos">
                                {{ user.first_name }} {{ user.last_name }} - {{ user.username }}
                            </div>
                        </div>
                    </mat-list>
                </mat-tab>
            </mat-tab-group>
        </mat-card>
    </mat-sidenav>
    <mat-sidenav-content class="right">
        <div class="chat-center-container">
            <ng-container *ngIf="!selectedConversation">
                <div class="empty-view">
                    Please select a conversation from the left side.
                </div>
            </ng-container>
            <ng-container *ngIf="selectedConversation">
                <div class="user-banner">
                    <div class="user-banner-left" (click)="viewProfile(selectedConversation)">
                        <div class="user-avatar">
                            <img src="{{ selectedConversation.picture_1 }}" alt="User Avatar">
                        </div>
                        <div class="user-info">
                            <h3>{{ selectedConversation.first_name }} {{ selectedConversation.last_name }}</h3>
                            <p>@{{ selectedConversation.username }}</p>
                            <div class="user-status">
                                <div class="dot"
                                    [ngClass]="{'online': selectedConversation.status === 'Online', 'offline': selectedConversation.status === 'Offline'}">
                                </div>
                                <div class="status-text">
                                    {{ selectedConversation.status }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="user-banner-right">
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon>more_horiz</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <button mat-menu-item
                                *ngIf="selectedConversation.block.author_id !== selectedConversation.id && !selectedConversation.block.isBlocked"
                                (click)="blockUser(selectedConversation)">
                              <mat-icon>block</mat-icon>
                              <span>Block user</span>
                            </button>
                            <button mat-menu-item
                                *ngIf="selectedConversation.block.author_id !== selectedConversation.id && selectedConversation.block.isBlocked"
                                (click)="unblockUser(selectedConversation)">
                              <mat-icon>panorama_fish_eye</mat-icon>
                              <span>Unblock user</span>
                            </button>
                            <button mat-menu-item>
                                <mat-icon>shield</mat-icon>
                                <span>Report user</span>
                            </button>
                          </mat-menu>
                    </div>
                </div>
                <div class="chat-messages" #chatMessagesContainer>
                    <div *ngFor="let message of selectedConversationMessages" class="chat-message"
                        [ngClass]="{ 'own-user': message.author_id !== selectedConversation.id, 'other-user': message.author_id === selectedConversation.id }">
                        <div class="message-content">
                            {{ message.message }}
                        </div>
                        <div class="message-date">
                            {{ message.date | date: 'dd/MM/yyyy - HH:mm' }}
                        </div>
                    </div>
                </div>
            </ng-container>
            <div class="chat-input-container" *ngIf="selectedConversation" #inputContainer>
                <mat-form-field class="chat-input">
                    <input matInput #input placeholder="Type a message..." [(ngModel)]="message"
                        (keyup.enter)="sendMessage(selectedConversation.id)">
                </mat-form-field>
                <button mat-icon-button (click)="sendMessage(selectedConversation.id)">
                    <mat-icon>send</mat-icon>
                </button>
            </div>
        </div>
    </mat-sidenav-content>
</mat-sidenav-container>